# DESCRIPTION: 
# Builds and pushes a docker image for a given FHIR version

parameters:
- name: version
  type: string
- name: tag
  type: string

steps:
- task: DockerCompose@0
  displayName: 'Build FHIR ${{parameters.version}} Server Image'
  inputs:
    action: Build services
    dockerComposeFile: build/docker/docker-compose.yaml
    dockerComposeFileArgs: FHIR_VERSION = ${{parameters.version}}
    projectName: ${{parameters.version}}
    additionalImageTags: ${{parameters.tag}}

- task: DockerCompose@0
  displayName: 'Push FHIR ${{parameters.version}} Server Image'
  inputs:
    action: Push services
    dockerComposeFile: build/docker/docker-compose.yaml
    azureSubscriptionEndpoint: 'docker-build'
    azureContainerRegistry: 'healthplatformregistry.azurecr.io'
    projectName: ${{parameters.version}}
    additionalImageTags: ${{parameters.tag}}
